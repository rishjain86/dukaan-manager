<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Auto Setup - Dukaan Manager</title>
</head>
<body style="font-family:Arial;padding:20px">

<h2>Auto Setup Tool</h2>
<p>üëá ‡§®‡•Ä‡§ö‡•á ‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§™‡§®‡§æ FirebaseConfig <b>JSON format</b> ‡§Æ‡•á‡§Ç paste ‡§ï‡§∞‡•á‡§Ç‡•§<br>
(‡§ï‡•ã‡§à <b>const</b> ‡§Ø‡§æ <b>variable name</b> ‡§®‡§π‡•Ä‡§Ç ‚Äî ‡§∏‡§ø‡§∞‡•ç‡§´ JSON object)</p>

<textarea id="cfg" style="width:100%;height:180px;font-size:14px;">
{
  "apiKey": "",
  "authDomain": "",
  "projectId": "",
  "storageBucket": "",
  "messagingSenderId": "",
  "appId": "",
  "measurementId": ""
}
</textarea><br><br>

<button id="run" style="padding:10px 20px;font-size:16px;background:#1976D2;color:white;border:none;border-radius:6px;">Run Auto Setup</button>

<pre id="out" style="background:#f4f4f4;padding:10px;margin-top:15px;white-space:pre-wrap;"></pre>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
document.getElementById('run').onclick = async function () {
    let out = document.getElementById('out');
    out.textContent = "Processing...";

    try {
        let text = document.getElementById('cfg').value.trim();

        // Remove accidental "const ..." wrappers
        if (text.startsWith("const")) {
            text = text.substring(text.indexOf("{"));
        }

        // Remove trailing semicolon if present
        if (text.endsWith(";")) text = text.slice(0, -1);

        // Parse firebase config as JSON
        let config = JSON.parse(text);

        // Init Firebase
        firebase.initializeApp(config);
        const db = firebase.firestore();

        const ownerUid = "AdXfUF6kBzf0FagiQQdBreji1MP2";  // YOUR UID
        const shopId = "SHOP001";

        // Create shopUsers mapping
        await db.collection("shopUsers").doc(ownerUid).set({
            shopId: shopId,
            role: "owner",
            phone: "9999999999",
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // Create shop document
        await db.collection("shops").doc(shopId).set({
            shopId: shopId,
            name: "‡§∂‡•ç‡§∞‡•Ä ‡§∞‡§æ‡§ß‡§æ ‡§ú‡§®‡§∞‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞",
            ownerUid: ownerUid,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        out.textContent = "‚úî SHOP001 created\n‚úî shopUsers mapping created\n\nNow open SEED page to import 50 items.";

    } catch (e) {
        out.textContent = "‚ùå ERROR: " + e.message;
    }
};
</script>
</body>
</html>
