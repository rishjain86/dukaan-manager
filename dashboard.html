<!DOCTYPE html><html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dukaan Manager ‚Äî Final Dashboard</title>  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">  <style>
    body { background:#f8f9fa; padding:12px; }
    table th, table td { text-align:center; vertical-align:middle; }
    .thumb-img { width:45px; height:45px; object-fit:cover; border-radius:6px; }
    #photo-preview { width:90px; height:90px; object-fit:cover; border-radius:8px; border:1px solid #ddd; margin-bottom:10px; display:none; }
  </style></head>
<body><nav class="navbar navbar-dark bg-primary mb-3">
  <div class="container-fluid">
    <span class="navbar-brand">üì¶ Dukaan Manager</span>
    <button onclick="logout()" class="btn btn-light btn-sm">Logout</button>
  </div>
</nav><div class="container">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h4>üì¶ ‡§á‡§®‡•ç‡§µ‡•á‡§Ç‡§ü‡§∞‡•Ä</h4>
    <button class="btn btn-success" onclick="openModal()">+ ‡§®‡§Ø‡§æ ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
  </div>  <div class="table-responsive">
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th>‡§´‡•ã‡§ü‡•ã</th>
          <th>‡§®‡§æ‡§Æ</th>
          <th>‡§è‡§Æ‡§Ü‡§∞‡§™‡•Ä</th>
          <th>‡§°‡§ø‡§∏‡•ç‡§ï‡§æ‡§â‡§Ç‡§ü %</th>
          <th>‡§ë‡§´‡§∞ ‡§™‡•ç‡§∞‡§æ‡§á‡§∏</th>
          <th>‡§∏‡•ç‡§ü‡•â‡§ï</th>
          <th>‡§á‡§ï‡§æ‡§à</th>
          <th>‡§∂‡•ç‡§∞‡•á‡§£‡•Ä</th>
          <th>‡§ï‡§æ‡§∞‡•ç‡§Ø</th>
        </tr>
      </thead>
      <tbody id="inventory-table"></tbody>
    </table>
  </div>  <div id="status" class="small text-muted mt-2"></div>
</div><!-- Modal --><div class="modal fade" id="itemModal" tabindex="-1">
 <div class="modal-dialog modal-lg">
  <div class="modal-content">
   <div class="modal-header">
    <h5 id="modal-title" class="modal-title">‡§®‡§Ø‡§æ ‡§Ü‡§á‡§ü‡§Æ</h5>
    <button class="btn-close" data-bs-dismiss="modal"></button>
   </div>
   <div class="modal-body"><img id="photo-preview" />

<input type="hidden" id="item-id" />

<div class="mb-2">
  <label class="form-label">‡§®‡§æ‡§Æ</label>
  <input id="item-name" class="form-control">
</div>

<div class="row">
  <div class="col-md-4 mb-2">
    <label class="form-label">‡§ï‡•Ä‡§Æ‡§§ (‚Çπ)</label>
    <input id="item-price" type="number" class="form-control">
  </div>
  <div class="col-md-4 mb-2">
    <label class="form-label">‡§°‡§ø‡§∏‡•ç‡§ï‡§æ‡§â‡§Ç‡§ü (%)</label>
    <input id="item-discount" type="number" class="form-control">
  </div>
  <div class="col-md-4 mb-2">
    <label class="form-label">‡§ë‡§´‡§∞ ‡§™‡•ç‡§∞‡§æ‡§á‡§∏ (‚Çπ)</label>
    <input id="item-offerprice" type="number" class="form-control">
  </div>
</div>

<div class="row">
  <div class="col-md-4 mb-2">
    <label class="form-label">‡§∏‡•ç‡§ü‡•â‡§ï</label>
    <input id="item-stock" type="number" class="form-control">
  </div>
  <div class="col-md-4 mb-2">
    <label class="form-label">‡§á‡§ï‡§æ‡§à</label>
    <input id="item-unit" class="form-control">
  </div>
  <div class="col-md-4 mb-2">
    <label class="form-label">‡§∂‡•ç‡§∞‡•á‡§£‡•Ä</label>
    <input id="item-category" class="form-control">
  </div>
</div>

<div class="mb-2">
  <label class="form-label">‡§´‡•ã‡§ü‡•ã</label>
  <input id="item-photo" type="file" accept="image/*" class="form-control">
</div>

   </div>
   <div class="modal-footer">
    <button class="btn btn-secondary" data-bs-dismiss="modal">‡§∞‡§¶‡•ç‡§¶</button>
    <button class="btn btn-primary" onclick="saveItem()">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
   </div>
  </div>
 </div>
</div><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script><script>
// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyAomDsqeLOrXvnudqUsudnZWOphuqM0bvY",
    authDomain: "shopkeeper-99756.firebaseapp.com",
    projectId: "shopkeeper-99756",
    storageBucket: "shopkeeper-99756.firebasestorage.app",
    messagingSenderId: "786338847396",
    appId: "1:786338847396:web:c6e042952145780f8aa431",
    measurementId: "G-PCE1MM86YE"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Cloudinary
const CLOUDINARY_CLOUD = "darmz4wsz";
const CLOUDINARY_UPLOAD_PRESET = "emotional_preset";
const CLOUDINARY_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD}/upload`;

let shopId = null;
let inventoryUnsub = null;

function setStatus(msg,type='secondary'){
  const el=document.getElementById('status');
  el.textContent=msg;
  el.className=`small text-${type}`;
}

// Photo Preview
const photoInput=document.getElementById('item-photo');
photoInput.addEventListener('change',e=>{
  const file=e.target.files[0];
  if(!file) return;
  const preview=document.getElementById('photo-preview');
  preview.src=URL.createObjectURL(file);
  preview.style.display='block';
});

function getThumb(url){ return url || 'https://via.placeholder.com/45'; }

// Load Inventory
function startInventoryListener(){
  inventoryUnsub = db.collection('shops').doc(shopId).collection('items').orderBy('name')
  .onSnapshot(snap=>{
    let html='';
    snap.forEach(doc=>{
      const i=doc.data();
      const offer = i.offerPrice ?? i.price;
      html+=`<tr>
        <td><img src="${getThumb(i.imageUrl)}" class="thumb-img"></td>
        <td>${i.name}</td>
        <td>‚Çπ${i.price}</td>
        <td>${i.discountPercent||0}%</td>
        <td>‚Çπ${offer}</td>
        <td>${i.stock}</td>
        <td>${i.unit}</td>
        <td>${i.category}</td>
        <td>
          <button class='btn btn-warning btn-sm me-1' onclick="editItem('${doc.id}')">‚úèÔ∏è</button>
          <button class='btn btn-danger btn-sm' onclick="deleteItem('${doc.id}')">üóë</button>
        </td>
      </tr>`;
    });
    document.getElementById('inventory-table').innerHTML=html;
    setStatus(`Loaded ${snap.size} items`,'success');
  });
}

// Open Modal
function openModal(){
  document.getElementById('modal-title').textContent='‡§®‡§Ø‡§æ ‡§Ü‡§á‡§ü‡§Æ';
  ['item-id','item-name','item-price','item-stock','item-unit','item-category','item-discount','item-offerprice'].forEach(x=>document.getElementById(x).value='');
  document.getElementById('item-photo').value='';
  document.getElementById('photo-preview').style.display='none';
  new bootstrap.Modal(document.getElementById('itemModal')).show();
}

// Edit Item
async function
